<!DOCTYPE html>
<html lang="en">
<html xmlns:th="https://www.thymeleaf.org">
<meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
<head th:replace="~{user/fragments/head :: head('TOEIC Mentor - Home')}"></head>
<body>
<!-- screen-bg start -->
<div class="screen-bg"></div>
<div th:insert="~{user/fragments/header::header}"></div>
<!-- header end -->
<div th:insert="~{user/fragments/main_menu::main-menu}"></div>
<!-- main start -->
<main id="main">
    <!-- main-slider start -->
    <section class="slider-content">
        <div class="home-slider owl-carousel owl-theme" id="home-slider">
            <div class="item" th:each="product : ${productHomeSliders}">
                <div class="slider-image">
                    <div class="slide-img" style="display: flex; justify-content: center;">
                        <img th:src="${product.getThumbnail()}"
                             style="max-width: 100%; max-height: 500px; width: auto; height: auto" alt="slider">
                        <img th:src="${product.getThumbnail()}" class="img-fluid resp-img" alt="mobile-slider">
                    </div>
                    <div class="container slider-text-info">
                        <div class="slider-text-content">
                            <span class="sub-title" th:text="${product.price}"></span>
                            <h2><span th:text="${product.name}"></span></h2>
                            <a th:href="@{/products/{id}(id=${product.id})}" class="btn-block">
                                <span class="shopnow">Shop now</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- main-slider end -->
    <!-- category-slider start -->
    <section class="slider-category section-pt">
        <div class="section-capture">
            <div class="section-title">
                <h2 data-animate="animate__fadeInUp">Popular brand</h2>
            </div>
        </div>
        <!-- brand-slider start -->
        <div class="brand-area section-pb">
            <div class="container">
                <div class="testi-category">
                    <div class="testi-wrap">
                        <div class="brand-slider owl-carousel owl-theme" id="brand-slider">
                            <div class="item" data-animate="animate__fadeInUp" th:each="brand : ${brands}">
                                <div class="brand-img">
                                    <a th:href="@{/products(brandNames=${brand.name})}" class="brand-img"><img
                                            th:src="*{brand.getImage()}" class="img-fluid"
                                            alt="brand"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- brand-slider end -->
    </section>
    <!-- category-slider end -->

    <!-- product-tab start -->
    <section class="product-tab-area section-ptb">
        <div class="container">
            <div class="collection-category">
                <div class="section-capture">
                    <div class="section-title">
                        <h2 data-animate="animate__fadeInUp">Trending product</h2>
                    </div>
                </div>
                <div class="collection-wrap">
                    <div class="collection-slider swiper" id="new-product">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" data-animate="animate__fadeInUp"
                                 th:each="product : ${productHomeTrending}">
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/product-template.html" class="pro-img">
                                            <img th:src="${product.thumbnail}" class="img-fluid img1 resp-img1"
                                                 alt="p-1">
                                            <img th:src="${product.thumbnail}" class="img-fluid img2 resp-img2"
                                                 alt="p-2">
                                        </a>
                                        <div class="product-action">
                                            <a href="#" class="quickview" th:data-product-id="${product.getId()}">
                                                <span class="product-icon"><i class="feather-eye"></i></span>
                                                <span class="tooltip-text">quickview</span>
                                            </a>
                                        </div>
                                        <!-- Thêm thuộc tính xác thực -->
                                        <div th:attr="data-authenticated=${user != null}"></div>
                                        <div class="product-cart">
                                            <button type="button" class="add-to-cart"
                                                    th:attr="data-product-id=${product.id}"
                                                    onclick="addToCart(this)">
                                                <span class="product-icon">
                                                    <span class="product-bag-icon"><i class="feather-shopping-bag"></i></span>
                                                    <span class="product-loader-icon"><i class="feather-loader"></i></span>
                                                    <span class="product-check-icon"><i class="feather-check"></i></span>
                                                </span>
                                            </button>
                                        </div>

                                    </div>
                                    <div class="product-content">
                                        <div class="product-title">
                                            <h6><a th:href="@{/products/{id}(id=${product.id})}" th:text="${product.name}"></a></h6>
                                        </div>
                                        <div class="price-box">
                                            <span class="new-price" th:text="'' + ${product.price}"></span>
                                            <!--                                            <span class="old-price">$70.00</span>-->
                                        </div>
                                        <div class="product-ratting">
                                                    <span class="review-ratting">
                                                        <span class="review-star">
                                                            <span th:if="${product.getStars() > 0}">
                                                                <span th:each="i : ${#numbers.sequence(1, product.stars)}">
                                                                    <i class="fas fa-star"></i>
                                                                </span>
                                                            </span>
                                                            <span th:if="${product.getStars() < 5}">
                                                                <span th:each="i : ${#numbers.sequence(1, 5 - product.stars)}">
                                                                    <i class="feather-star"></i>
                                                                </span>
                                                            </span>
                                                        </span>
                                                        <span class="review-caption">No reviews</span>
                                                    </span>
                                        </div>
                                        <div class="product-description">
                                            <p th:text="${product.description}"></p>
                                        </div>
                                        <div class="product-action">
                                            <a th:href="@{/add-cart}" class="add-to-cart">
                                                        <span class="product-icon">
                                                            <span class="product-bag-icon"><i
                                                                    class="feather-shopping-bag"></i></span>
                                                            <span class="product-loader-icon"><i
                                                                    class="feather-loader"></i></span>
                                                            <span class="product-check-icon"><i
                                                                    class="feather-check"></i></span>
                                                        </span>
                                                <span class="tooltip-text">add to cart</span>
                                            </a>
                                            <a href="#quickview-modal" data-bs-toggle="modal" class="quick-view">
                                                <span class="product-icon"><i class="feather-eye"></i></span>
                                                <span class="tooltip-text">quickview</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="collection-button" data-animate="animate__fadeInUp">
                            <a th:href="@{/products}" class="btn-style3">view more</a>
                        </div>
                    </div>
                    <div class="swiper-buttons">
                        <div class="swiper-buttons-wrap">
                            <button class="swiper-prev swiper-prev-new"><i class="feather-arrow-left"></i></button>
                            <button class="swiper-next swiper-next-new"><i class="feather-arrow-right"></i></button>
                        </div>
                    </div>
                    <div class="swiper-dots">
                        <div class="swiper-pagination swiper-pagination-new"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- product-tab end -->
    <!-- testimonials-slider start -->
    <section class="testimonials-slider section-ptb">
        <div class="section-capture">
            <div class="section-title">
                <h2 data-animate="animate__fadeInUp">Our customers love</h2>
            </div>
        </div>
        <div class="container">
            <div class="testi-category">
                <div class="testi-wrap">
                    <div class="testi-slider owl-carousel owl-theme" id="testimonials-slider">
                        <div class="item" data-animate="animate__fadeInUp">
                            <div class="testi-content">
                                <div class="test-quite">
                                    <a href="JavaScript:void(0)"><i class="fa fa-quote-left"></i></a>
                                </div>
                                <div class="testi-desc">
                                    <p>Trang web rõ ràng, nhân viên tư vấn kỹ, đặc biệt giao hàng đúng giờ. Lần sau sẽ giới thiệu bạn bè đến mua!</p>
                                </div>
                                <div class="testi-image">
                                    <span><img th:src="@{/user/asset/image/home1/testimonial/test-1.jpg}"
                                               class="img-fluid" alt="test-2"></span>
                                </div>
                                <div class="author-info">
                                    <h6>Nguyễn Thảo Vy</h6>
                                </div>
                                <span class="review-star">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star-half-alt"></i>
                                        </span>
                            </div>
                        </div>
                        <div class="item" data-animate="animate__fadeInUp">
                            <div class="testi-content">
                                <div class="test-quite">
                                    <a href="JavaScript:void(0)"><i class="fa fa-quote-left"></i></a>
                                </div>
                                <div class="testi-desc">
                                    <p>Dịch vụ rất chuyên nghiệp, có cả trả góp 0% lãi suất, giao hàng tận nơi và hỗ trợ kỹ thuật miễn phí sau khi mua.
                                         Rất đáng tin cậy!</p>
                                </div>
                                <div class="testi-image">
                                    <span><img th:src="@{/user/asset/image/home1/testimonial/test-2.jpg}"
                                               class="img-fluid" alt="test-2"></span>
                                </div>
                                <div class="author-info">
                                    <h6>Lê Quỳnh Anh</h6>
                                </div>
                                <span class="review-star">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                        </span>
                            </div>
                        </div>
                        <div class="item" data-animate="animate__fadeInUp">
                            <div class="testi-content">
                                <div class="test-quite">
                                    <a href="JavaScript:void(0)"><i class="fa fa-quote-left"></i></a>
                                </div>
                                <div class="testi-desc">
                                    <p>Mình mua iPhone 15 Pro Max ở đây với giá rẻ hơn 2 cửa hàng khác. Hàng chính hãng, bảo hành đầy đủ. Giao hàng cũng cực nhanh!</p>
                                </div>
                                <div class="testi-image">
                                    <span><img th:src="@{/user/asset/image/home1/testimonial/test-3.jpg}"
                                               class="img-fluid" alt="test-2"></span>
                                </div>
                                <div class="author-info">
                                    <h6>Vũ Thành Đạt </h6>
                                </div>
                                <span class="review-star">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                        </span>
                            </div>
                        </div>
                        <div class="item" data-animate="animate__fadeInUp">
                            <div class="testi-content">
                                <div class="test-quite">
                                    <a href="JavaScript:void(0)"><i class="fa fa-quote-left"></i></a>
                                </div>
                                <div class="testi-desc">
                                    <p>Website dễ dùng, lọc máy theo nhu cầu nhanh. Tư vấn viên hỗ trợ nhiệt tình, mình chọn được đúng chiếc phù hợp với công việc.</p>
                                </div>
                                <div class="testi-image">
                                    <span><img th:src="@{/user/asset/image/home1/testimonial/test-4.jpg}"
                                               class="img-fluid" alt="test-2"></span>
                                </div>
                                <div class="author-info">
                                    <h6>Nguyễn Hoàng Long</h6>
                                </div>
                                <span class="review-star">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star-half-alt"></i>
                                        </span>
                            </div>
                        </div>
                        <div class="item" data-animate="animate__fadeInUp">
                            <div class="testi-content">
                                <div class="test-quite">
                                    <a href="JavaScript:void(0)"><i class="fa fa-quote-left"></i></a>
                                </div>
                                <div class="testi-desc">
                                    <p>Mình đặt Galaxy S23 Ultra hôm qua, hôm nay đã nhận được hàng. Đóng gói kỹ, máy mới nguyên seal. Sẽ ủng hộ lần sau!</p>
                                </div>
                                <div class="testi-image">
                                    <span><img th:src="@{/user/asset/image/home1/testimonial/test-5.jpg}"
                                               class="img-fluid" alt="test-2"></span>
                                </div>
                                <div class="author-info">
                                    <h6>Đỗ Khánh Linh</h6>
                                </div>
                                <span class="review-star">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star-half-alt"></i>
                                        </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- testimonials-slider end -->

    <!-- offer-text-section start -->
    <div class="offer-text-area section-tb-padding">
        <div class="offer-text-wrap">
            <div class="offer-text">
                <ul>
                    <li class="text1">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                    <li class="text2">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                    <li class="text1">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                    <li class="text2">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                    <li class="text1">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                    <li class="text2">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                    <li class="text1">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                    <li class="text2">
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Newest products 10% off use code: NEW10</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Summer sale discount 40% off all products</p>
                        </div>
                        <div class="offer-text-block">
                            <p>Explore the latest shopping related offers</p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <br>
    <!-- offer-text-section end -->
    <!-- service-area start-->
    <div class="service-area section-p" data-animate="animate__fadeInUp">
        <div class="container">
            <ul class="single-service">
                <li class="service-content" data-animate="animate__fadeInUp">
                    <div class="ser-block">
                        <a class="service-icon" href="JavaScript:void(0)">
                            <span><i class="feather-truck"></i></span>
                        </a>
                        <div class="service-text">
                            <h6>Free shipping</h6>
                            <p>Delivery within 5 to 7 day</p>
                        </div>
                    </div>
                </li>
                <li class="service-content" data-animate="animate__fadeInUp">
                    <div class="ser-block">
                        <a class="service-icon" href="JavaScript:void(0)">
                            <span><i class="feather-gift"></i></span>
                        </a>
                        <div class="service-text">
                            <h6>Gift voucher</h6>
                            <p>Surprise coupon voucher</p>
                        </div>
                    </div>
                </li>
                <li class="service-content" data-animate="animate__fadeInUp">
                    <div class="ser-block">
                        <a class="service-icon" href="JavaScript:void(0)">
                            <span><i class="feather-shield"></i></span>
                        </a>
                        <div class="service-text">
                            <h6>Money back</h6>
                            <p>Refund within 30 days</p>
                        </div>
                    </div>
                </li>
                <li class="service-content" data-animate="animate__fadeInUp">
                    <div class="ser-block">
                        <a class="service-icon" href="JavaScript:void(0)">
                            <span><i class="feather-briefcase"></i></span>
                        </a>
                        <div class="service-text">
                            <h6>Safe payment</h6>
                            <p>100% secure with us</p>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <!-- service-area end-->
</main>
<!-- main end -->
<!-- footer start -->
<br>
<div th:insert="~{user/fragments/footer::footer}"></div>
<!-- footer end -->
<!-- Quickview Modal -->
<div class="modal fade quickview-modal" id="quickview-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="quickview-content"></div>
            </div>
        </div>
    </div>
</div>
<!-- Quickview Modal End -->
<!-- search-modal start -->
<div class="search-modal modal fade" id="searchmodal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="container">
                    <div class="search-content">
                        <div class="search-box">
                            <button type="button" class="search-close" data-bs-dismiss="modal"><span><i
                                    class="feather-x"></i></span></button>
                            <form method="get" action="https://spacingtech.com/search" class="search-form">
                                <div class="search-bar">
                                    <div class="form-search">
                                        <input type="search" name="search-input" class="search-input" value=""
                                               placeholder="Search our store" required="">
                                        <button type="button" onclick="location.href='search.html'" class="search-btn"
                                                disabled=""><i class="feather-search"></i></button>
                                    </div>
                                    <div class="search-results">
                                        <p class="search-for">Search for <span class="search-text">a</span></p>
                                        <ul>
                                            <li>
                                                <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/product-template.html">
                                                    <img th:src="@{/user/asset/image/home1/product/product-1.jpg}"
                                                         class="img-fluid" alt="product-1.jpg}">
                                                    <span>Earbuds</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/product-template.html">
                                                    <img th:src="@{/user/asset/image/home1/product/product-7.jpg}"
                                                         class="img-fluid" alt="product-7.jpg}">
                                                    <span>Sandisk ssd</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/product-template.html">
                                                    <img th:src="@{/user/asset/image/home1/product/product-15.jpg}"
                                                         class="img-fluid" alt="product-15.jpg}">
                                                    <span>Router wifi6</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/product-template.html">
                                                    <img th:src="@{/user/asset/image/home1/product/product-18.jpg}"
                                                         class="img-fluid" alt="product-18.jpg}">
                                                    <span>Smartphone</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/product-template.html">
                                                    <img th:src="@{/user/asset/image/home1/product/product-31.jpg}"
                                                         class="img-fluid" alt="product-31.jpg}">
                                                    <span>IPad mini</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/product-template.html">
                                                    <img th:src="@{/user/asset/image/home1/product/product-49.jpg}"
                                                         class="img-fluid" alt="product-49.jpg}">
                                                    <span>HP color printer</span>
                                                </a>
                                            </li>
                                        </ul>
                                        <p class="search-more"><a href="../../../../../../../TechStore-master/src/main/resources/templates/user/search.html">See all results (12)</a></p>
                                        <p class="search-fail">Search not found</p>
                                    </div>
                                    <a href="../../../../../../../TechStore-master/src/main/resources/templates/user/search.html" class="search-btn">Search</a>
                                </div>
                            </form>
                        </div>
                        <div class="search-example-text">Trending search: a, e, Sunglasses...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- search-modal end -->
<!-- cart-drawer start -->
<div th:insert="~{user/fragments/cart_drawer::cart-drawer}"></div>
<!-- cart-drawer end -->

<!-- back-to-top start -->
<a href="javascript:void(0)" id="top" class="scroll"><span><i class="feather-arrow-up"></i></span></a>
<!-- back-to-top end -->
</body>
<!-- plugin js -->
<script th:src="@{/user/asset/js/plugin.js}"></script>
<!-- theme js -->
<script th:src="@{/user/asset/js/main.js}"></script>
<script>
    function addToCart(button) {
        const isAuthenticated = [[${#authentication.principal != 'anonymousUser'}]];
        if (!isAuthenticated) {
            window.location.href = "/login";
            return;
        }

        const productId = button.getAttribute('data-product-id');

        fetch(`/add-cart?productId=${productId}`, {
            method: 'GET'
        })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('Thêm thất bại!');
                }
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra!');
            });
    }
</script>
<script>
    function increaseQuantity(button) {
        console.log("increaseQuantity called");
        const productId = getProductId(button);
        fetch(window.location.origin + "/add-cart?productId=" + productId)
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Tăng số lượng thất bại!');
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message);
            });
    }

    function decreaseQuantity(button) {
        console.log("decreaseQuantity called");
        const productId = getProductId(button);
        fetch(window.location.origin + "/decrease-cart?productId=" + productId)
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Giảm số lượng thất bại!');
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message);
            });
    }

    function deleteItem(button) {
        console.log("deleteItem called");
        const productId = getProductId(button);
        fetch(window.location.origin + "/delete-cart?productId=" + productId)
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Xóa sản phẩm thất bại!');
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message);
            });
    }

    function getProductId(button) {
        const cartItem = button.closest('.cart-item');
        return cartItem ? cartItem.getAttribute('data-product-id') : null;
    }
</script>
<script th:src="@{/user/asset/js/search-autocomplete.js}"></script>
<script>
    // Quickview functionality
    document.addEventListener('DOMContentLoaded', function() {
        const quickviewButtons = document.querySelectorAll('.quickview');

        quickviewButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const productId = this.getAttribute('data-product-id');

                // Load quickview content
                fetch(`/products/quickview/${productId}`)
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById('quickview-content').innerHTML = html;

                        // Initialize modal
                        const modal = new bootstrap.Modal(document.getElementById('quickview-modal'));
                        modal.show();

                        // Initialize Swiper for quickview slider
                        const galleryThumbs = new Swiper('.gallery-thumbs', {
                            spaceBetween: 10,
                            slidesPerView: 4,
                            freeMode: true,
                            watchSlidesVisibility: true,
                            watchSlidesProgress: true,
                        });

                        const galleryTop = new Swiper('.gallery-top', {
                            spaceBetween: 10,
                            navigation: {
                                nextEl: '.quick-next',
                                prevEl: '.quick-prev',
                            },
                            thumbs: {
                                swiper: galleryThumbs
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Có lỗi xảy ra khi tải quickview!');
                    });
            });
        });
    });
</script>

</html>